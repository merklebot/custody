version: "3.8"

services:
  custody:
    image: ghcr.io/merklebot/custody:main
    networks:
      - internal
    environment:
      DATABASE_URL:
    deploy:
      labels:
        - traefik.http.routers.custody.entrypoints=websecure
        - traefik.http.routers.custody.rule=Host(`2.contabo.merklebot.com`) && PathPrefix(`/custody`)
        - traefik.http.routers.custody.tls=true
        - traefik.http.routers.custody.tls.certresolver=letsencrypt
        - traefik.http.services.custody.loadbalancer.server.port=8000
        - traefik.http.middlewares.strip-custody.stripprefix.prefixes=/custody
        - traefik.http.routers.custody.middlewares=strip-custody@docker

networks:
  internal:
    external: true # externally created
